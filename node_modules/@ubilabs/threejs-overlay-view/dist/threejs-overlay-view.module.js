import{Vector3 as e,MathUtils as t,Matrix4 as r,WebGL1Renderer as n,Scene as i,HemisphereLight as a,DirectionalLight as o,Vector2 as s,Raycaster as l,PerspectiveCamera as h}from"three";function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var u=Math.sin,d=Math.cos,v=Math.pow,f=Math.sqrt,p=Math.atan2,g=Math.asin,y=Math.sign,w=t.degToRad,m=t.radToDeg,M=t.euclideanModulo;function x(e,t){var r=e.lat,n=e.lng,i=t.lat,a=t.lng,o=w(i-r),s=w(a-n),l=w(r),h=w(i),c=v(u(o/2),2)+v(u(s/2),2)*d(l)*d(h);return 2*p(f(c),f(1-c))*6371008.8}var b=new r,A=function(){function t(e){this.overlay=void 0,this.camera=void 0,this.renderer=void 0,this.scene=void 0,this.referencePoint=void 0,this.viewportSize=new s,this.raycaster=new l,this.onAdd=null,this.onRemove=null,this.update=null,this.referencePoint=c({altitude:0},e),this.overlay=this.initWebGLOverlayView(),this.renderer=null,this.scene=this.initScene(),this.camera=new h}var r=t.prototype;return r.setMap=function(e){this.overlay.setMap(e)},r.setReferencePoint=function(e){this.referencePoint=c({altitude:0},e)},r.getScene=function(){return this.scene},r.getViewportSize=function(){return this.viewportSize},r.requestRedraw=function(){this.overlay.requestRedraw()},r.raycast=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r={updateMatrix:!0,recursive:!1});var n=r.recursive,i=r.raycasterParameters;r.updateMatrix&&b.copy(this.camera.projectionMatrix).invert(),this.raycaster.ray.origin.set(e.x,e.y,0).applyMatrix4(b),this.raycaster.ray.direction.set(e.x,e.y,.5).applyMatrix4(b).sub(this.raycaster.ray.origin).normalize();var a=this.raycaster.params;i&&(this.raycaster.params=i),null===t&&(t=this.scene,n=!0);var o=Array.isArray(t)?this.raycaster.intersectObjects(t,n):this.raycaster.intersectObject(t,n);return this.raycaster.params=a,o},r.latLngAltToVector3=function(t,r){return void 0===r&&(r=new e),function(t,r,n){void 0===n&&(n=new e);var i=x(r,{lng:t.lng,lat:r.lat}),a=x(r,{lng:r.lng,lat:t.lat}),o=y(t.lng-r.lng),s=y(t.lat-r.lat),l=t.altitude;return n.set(o*i,s*a,void 0===l?0:l)}(t,this.referencePoint,r)},r.vector3ToLatLngAlt=function(e,t){return void 0===t&&(t={lat:0,lng:0,altitude:0}),function(e,t,r){return void 0===r&&(r={lat:0,lng:0,altitude:0}),function(e,t,r,n){void 0===n&&(n={lat:0,lng:0});var i=w(e.lng),a=w(e.lat),o=w(r),s=t/6371008.8,l=g(u(a)*d(s)+d(a)*u(s)*d(o)),h=i+p(u(o)*u(s)*d(a),d(s)-u(a)*u(l));n.lat=m(l),n.lng=m(h)}(t,e.length(),function(e){return M(90-m(p(e.y,e.x)),360)}(e),r),r.altitude=e.z,r}(e,this.referencePoint,t)},r.onContextRestored=function(e){var t=e.gl,r=new n(c({canvas:t.canvas,context:t},t.getContextAttributes()));r.autoClear=!1,r.autoClearDepth=!1;var i=t.canvas;this.viewportSize.set(i.width,i.height),this.renderer=r},r.onContextLost=function(){this.renderer&&(this.viewportSize.set(0,0),this.renderer.dispose(),this.renderer=null)},r.onDraw=function(e){var t=e.gl,r=e.transformer;if(this.scene&&this.renderer&&null!==this.overlay.getMap()){this.camera.projectionMatrix.fromArray(r.fromLatLngAltitude(this.referencePoint));var n=t.canvas,i=n.width,a=n.height;this.viewportSize.set(i,a),this.renderer.setViewport(0,0,i,a),this.update&&this.update(),this.renderer.render(this.scene,this.camera),this.renderer.resetState()}},r.initScene=function(){var e=new i,t=new a(16777215,4473924,1);t.position.set(0,-.2,1).normalize();var r=new o(16777215);return r.position.set(0,10,100),e.add(t,r),e},r.initWebGLOverlayView=function(){var e=this;if(!google||!google.maps)throw new Error("Google Maps API not loaded. Please make sure to create the overlay after the API has been loaded.");if(!google.maps.WebGLOverlayView)throw new Error("WebGLOverlayView not found. Please make sure to load the beta-channel of the Google Maps API.");var t=new google.maps.WebGLOverlayView;return t.onAdd=P(function(){null!==e.onAdd&&e.onAdd()}),t.onRemove=P(function(){null!==e.onRemove&&e.onRemove()}),t.onDraw=P(this.onDraw.bind(this)),t.onContextRestored=P(this.onContextRestored.bind(this)),t.onContextLost=P(this.onContextLost.bind(this)),t},t}();function P(e){return function(){try{return e.apply(void 0,[].slice.call(arguments))}catch(e){throw console.error(e),e}}}export default A;
//# sourceMappingURL=threejs-overlay-view.module.js.map
